@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Reception/Views/Shared/LayoutAdmin.cshtml";
}

<style>
    #item {
        max-width: 80%;
        min-width:160px;
        border: 2px solid black;
        border-radius: 15px;
        margin: 20px auto;
    }

    #item-header {
        padding: 10px 0;
        border-bottom: 2px solid black;
        display: flex;
        justify-content: space-between;
        margin:0 10px 10px 10px;
        gap: 10px;
    }

    #item-body {
        display: flex;
        justify-content: center;
        margin: 15px 0;
        gap: 10px;
    }

    #areaSelect {
        margin: 20px;
    }

    #item-header span:hover {
        font-weight: 700;
        color: red;
        cursor: pointer;
    }

    .mt-3 {
        width: 70%;
    }

    #roomListCheckIn {
        display: flex;
        flex-wrap: wrap;
    }

    .custom-dropdown {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

        .custom-dropdown a {
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

            .custom-dropdown a:hover {
                background-color: #f1f1f1;
            }

    .show-dropdown {
        display: block;
    }
</style>

<div class="mt-3">
    <select id="areaSelect" style="width: 40%">
        <option value="">Chọn khu vực</option>
    </select>

    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" href="#home">Phòng chờ</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#menu1">Phòng đang thuê</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#menu2">Phòng cần dọn</a>
        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content border mb-3">
        <div id="home" class="container tab-pane active">
            <br>
            <div id="roomListCheckIn">
                <!-- Dữ liệu phòng sẽ được hiển thị ở đây -->
            </div>
        </div>
        <div id="menu1" class="container tab-pane fade">
            <br>
            <div id="roomListCheckOut">
                <!-- Dữ liệu phòng sẽ được hiển thị ở đây -->
            </div>
        </div>
        <div id="menu2" class="container tab-pane fade">
            <br>
            <div id="roomListClear">
                <!-- Dữ liệu phòng sẽ được hiển thị ở đây -->
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        loadAreaOptions();
        $(".nav-tabs a").click(function () {
            $(this).tab('show');
        });
        $('.nav-tabs a').on('shown.bs.tab', function (event) {
            var x = $(event.target).text(); // active tab
            var y = $(event.relatedTarget).text(); // previous tab
            $(".act span").text(x);
            $(".prev span").text(y);
        });

        $('#areaSelect').change(function () {
            var selectedArea = $(this).val();
            getRoomsCheckInByArea(selectedArea);
        });
        
    });

    function loadAreaOptions() {
        $.ajax({
            url: '/Reception/Room/GetAreaList',
            type: 'GET',
            success: function (data) {
                console.log(data);
                if (data.code === 200) {
                    $('#areaSelect').empty();
                    $('#areaSelect').append($('<option>', {
                        value: "",
                        text: "Chọn khu vực"
                    }));
                    $.each(data.areas, function (i, item) {
                        $('#areaSelect').append($('<option>', {
                            value: item,
                            text: item
                        }));
                    });
                } else {
                    console.log("Lỗi khi lấy danh sách khu vực: " + data.msg);
                }
            },
            error: function (error) {
                console.log("Lỗi khi lấy danh sách khu vực: " + error);
            }
        });
    }

    function getRoomsCheckInByArea(selectedArea) {
        var area = selectedArea;

        $.ajax({
            url: '/Reception/CheckIn_CheckOut/GetRoomAvaiable',
            type: 'get',
            data: { Area: area },
            success: function (data) {
                if (data.code === 200) {
                    console.log(data);
                    var roomListCheckIn = $('#roomListCheckIn');
                    roomListCheckIn.empty();

                    $.each(data.rooms, function (i, rooms) {
                        var roomDiv = $('<div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">');

                        var itemDiv = $('<div id="item">');
                        var headerDiv = $('<div id="item-header"><div>' + rooms.RoomName + '</div></div>');
                        headerDiv.append('<span class="material-symbols-outlined" onclick="toggleDropdown(this)">more_vert</span>');
                        headerDiv.append('<div class="custom-dropdown"><a href="#">Nhận phòng</a><a href="#">Nhận đặt phòng</a></div>');
                        itemDiv.append(headerDiv);

                        var typeName = getTypeName(rooms.RoomTypeID);
                        var bodyDiv = $('<div id="item-body"><div><span class="material-symbols-outlined">emoji_people</span> <span>' + typeName + '</span> <span class="material-symbols-outlined">emoji_people</span></div></div>');
                        itemDiv.append(bodyDiv);

                        roomDiv.append(itemDiv);
                        roomListCheckIn.append(roomDiv);
                    });
                } else {
                    alert(data.msg);
                }
            }
        });
    }

    function getTypeName(typeID) {
        var typeName;
        $.ajax({
            url: '/Reception/Room/GetTypeName',
            type: 'GET',
            async: false,
            data: { typeID: typeID },
            success: function (data) {
                typeName = data.typeName;
            },
            error: function (error) {
                console.log("Lỗi khi lấy TypeName: " + error);
            }
        });
        return typeName;
    }

    $(document).ready(function () {
        $('#table-room-lst').DataTable();
        
    });

    
    function toggleDropdown(span) {
        console.log("Toggle Dropdown called");
        var dropdown = $(span).next('.custom-dropdown');
        dropdown.toggleClass('show-dropdown');
    }

    function handleDropdownClick(event) {
        event.stopPropagation();
    }


</script>
